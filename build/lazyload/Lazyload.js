/*! 2019-12-28 */

KISSY.add(function(h,_,n,t){var o=h.Env.host,e=o.document,r="data-src",m="default",i="scroll",a="touchmove",c="resize",s=0;function l(t,e,n){if(!t.offsetWidth)return!1;var o,i,a,r=_.offset(t),c=!0,s=r.left,l=r.top,u={left:s,top:l,right:s+((a=t)._ks_lazy_width?a._ks_lazy_width:a._ks_lazy_width=_.outerWidth(a)),bottom:l+((i=t)._ks_lazy_height?i._ks_lazy_height:i._ks_lazy_height=_.outerHeight(i))};return(o=f(e,u))&&n&&(c=f(n,u)),c&&o}function f(t,e){var n={};return n.top=Math.max(t.top,e.top),n.bottom=Math.min(t.bottom,e.bottom),n.left=Math.max(t.left,e.left),n.right=Math.min(t.right,e.right),n.bottom>=n.top&&n.right>=n.left}function u(t,e){var n=this;if(!(n instanceof u))return new u(t,e);var o=t;h.isPlainObject(o)||(o=e||{},t&&(o.container=t)),u.superclass.constructor.call(n,o),n._callbacks={},n._containerIsNotDocument=9!=n.get("container").nodeType,h.isArray(o.container)&&(n._backCompact=1),n._initLoadEvent(),o.container&&n.addElements(o.container,n.get("type")),n._loadFn(),h.ready(function(){n._loadFn()}),n.resume()}return u.ATTRS={diff:{value:0},placeholder:{value:"../../../resources/images/default_product.png"},execScript:{value:!0},container:{setter:function(t){return t=t||e,h.isWindow(t)?t=t.document:(t=_.get(t),"body"==_.nodeName(t)&&(t=t.ownerDocument)),t},valueFn:function(){return e}},autoDestroy:{value:!0},onStart:{value:null}},h.extend(u,t,{_initLoadEvent:function(){var t,e,n,o,i,a,r=this,c=r.get("autoDestroy");function s(){o&&(o.cancel(),o=0),i=h.now(),t.apply(n||this,arguments),a=h.now()}r._loadFn=(t=function(){c&&0==r._counter&&h.isEmptyObject(r._callbacks)&&r.destroy(),r._loadItems()},n=r,a=i=0,e=(e=100)||150,h.mix(function(){!i||i<=a&&h.now()-a>e||a<i&&h.now()-i>8*e?s():(o&&o.cancel(),o=h.later(s,e,0,null,arguments))},{stop:function(){o&&(o.cancel(),o=0)}}))},addCallback:function(t,e,n){t=_.get(t);var o=this._callbacks,i={el:t||document,fn:e||h.noop,outfn:n||h.noop},a=++s;o[a]=i,this._windowRegion?this._loadItem(a,i):this.refresh()},removeCallback:function(n,o){n=_.get(n);var i=this._callbacks;h.each(i,function(t,e){t.el!=n||o&&t.fn!=o||delete i[e]})},imgHandle:function(t){!function(t,e,n){e=e||r;var o,i=t.getAttribute(e),a={type:"img",elem:t,src:i};if((!h.isFunction(n)||!1!==n(a))&&a.src){o=a.src,t.src!=o&&(t.src=o),t.removeAttribute(e)}else console.log(t,i,e)}(t,this.get("imgFlag"),this.get("onStart")),this.removeElements(t)},addElements:function(t,e){"string"==typeof t?t=_.query(t):h.isArray(t)||(t=[t]);var n=this;n._counter=n._counter||0,h.each(t,function(t){e&&"img"!==e||h.each(h.filter([t].concat(_.query("img",t)),function(t){return t.getAttribute&&t.getAttribute(n.get("imgFlag")||r)},n),function(t){n.addCallback(t,n.imgHandle)})})},removeElements:function(n){"string"==typeof n?n=_.query(n):h.isArray(n)||(n=[n]);var o=this._callbacks;h.each(o,function(t,e){h.inArray(t.el,n)&&delete o[e]})},clear:function(){self._callbacks={}},refresh:function(){this._loadFn()},_loadItems:function(){var n=this,t=n.get("container");n._containerIsNotDocument&&!t.offsetWidth||(n._windowRegion=n._getBoundingRect(),!n._backCompact&&n._containerIsNotDocument&&(n._containerRegion=n._getBoundingRect(n.get("container"))),h.each(n._callbacks,function(t,e){t&&n._loadItem(e,t)}))},_loadItem:function(t,e){var n=this;if(!(e=e||n._callbacks[t]))return!0;var o=e.el,i=!1,a=e.fn,r=e.outfn;if(n.get("force")||l(o,n._windowRegion,n._containerRegion))try{i=a.call(n,o)}catch(t){setTimeout(function(){throw t},0)}else try{r.call(n,o)}catch(t){setTimeout(function(){throw t},0)}return!1!==i&&delete n._callbacks[t],i},_getBoundingRect:function(t){var e,n,o,i;if(void 0!==t){e=_.outerHeight(t),n=_.outerWidth(t);var a=_.offset(t);o=a.left,i=a.top}else e=_.viewportHeight(),n=_.viewportWidth(),o=_.scrollLeft(),i=_.scrollTop();var r=this.get("diff"),c=0,s=r===m?n:r,l=0,u=r===m?e:r,f=o+n,d=i+e;return h.isObject(r)&&(c=r.left||0,s=r.right||0,l=r.top||0,u=r.bottom||0),{left:o-=c,top:i-=l,right:f+=s,bottom:d+=u}},pause:function(){var t=this._loadFn;if(!this._destroyed&&(n.remove(o,i,t),n.remove(o,a,t),n.remove(o,c,t),t.stop(),this._containerIsNotDocument)){var e=this.get("container");n.remove(e,i,t),n.remove(e,a,t)}},resume:function(){var t=this._loadFn;if(!this._destroyed&&(n.on(o,i,t),n.on(o,a,t),n.on(o,c,t),this._containerIsNotDocument)){var e=this.get("container");n.on(e,i,t),n.on(e,a,t)}},destroy:function(){this.pause(),this._callbacks={},h.log("datalazyload is destroyed!"),this.fire("destroy"),this._destroyed=1}}),u},{requires:["dom","event","base"]});